(()=>{"use strict";var e={d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{on:()=>s,off:()=>u,setReaderEmail:()=>h,setAuthenticated:()=>l,refreshAuthentication:()=>p,getReader:()=>f,hasAuthLink:()=>w,getOTPHash:()=>m,authenticateOTP:()=>g,setAuthStrategy:()=>v,getAuthStrategy:()=>y,getCaptchaToken:()=>k,default:()=>b});const n={reader:"reader"},a={};function r(e){if(!e)return"";const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?decodeURIComponent(t.pop().split(";").shift()):void 0}function i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:365;const a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),document.cookie=`${e}=${t}; expires=${a.toUTCString()}; path=/`}const o=Object.values(n);function c(e){return o.includes(e)?`newspack-reader-activation-${e}`:""}function d(e,t){if(!(e=c(e)))throw"Invalid event";window.dispatchEvent(new CustomEvent(e,{detail:t}))}function s(e,t){if(!(e=c(e)))throw"Invalid event";window.addEventListener(e,t)}function u(e,t){if(!(e=c(e)))throw"Invalid event";window.removeEventListener(e,t)}function h(e){e&&(a.reader||(a.reader={}),a.reader.email=e,d(n.reader,a.reader))}function l(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!a.reader?.email)throw"Reader email not set";a.reader.authenticated=Boolean(e),d(n.reader,a.reader)}function p(){const e=r("np_auth_reader");e?(h(e),l(!0)):h(r("np_auth_intention"))}function f(){return a.reader}function w(){const e=f(),t=r("np_auth_link");return!(!e?.email||!t)}const _=["pwd","link"];function m(){return r("np_otp_hash")}function g(e){return new Promise(((t,n)=>{const a=m(),r=f()?.email;return a?r?e?void fetch("",{method:"POST",headers:{Accept:"application/json"},body:new URLSearchParams({action:newspack_reader_activation_data.otp_auth_action,email:r,hash:a,code:e})}).then((e=>e.json())).then((e=>{let{success:a,message:i,data:o}=e;const c={...o,email:r,authenticated:!!a,message:i};l(!!a),a?t(c):n(c)})):n({message:"Invalid code"}):n({message:"You must provide an email"}):n({message:"Code has expired",expired:!0})}))}function v(e){if(!_.includes(e))throw"Invalid authentication strategy";return i("np_auth_strategy",e),e}function y(){return m()?"otp":r("np_auth_strategy")}function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"submit";return new Promise(((t,n)=>{const{grecaptcha:a}=window;if(!a||!newspack_reader_activation_data)return t("");const{captcha_site_key:r}=newspack_reader_activation_data;if(!r)return t("");a?.ready||n("Error loading the reCaptcha library."),a.ready((()=>{a.execute(r,{action:e}).then((e=>t(e))).catch((e=>n(e)))}))}))}!function(){const e=newspack_reader_activation_data,t=e?.authenticated_email||r("np_auth_intention"),i=!!e?.authenticated_email;a.reader=t?{email:t,authenticated:i}:null,d(n.reader,a.reader)}();const S={on:s,off:u,setReaderEmail:h,setAuthenticated:l,refreshAuthentication:p,getReader:f,hasAuthLink:w,getOTPHash:m,authenticateOTP:g,setAuthStrategy:v,getAuthStrategy:y,getCaptchaToken:k};window.newspackReaderActivation=S;const A=newspack_reader_activation_data.cid_cookie;if(!r(A)){const e=()=>Math.floor(999999999*Math.random()).toString(36);i(A,`${e()}${e()}`)}window.newspackRAS=window.newspackRAS||[],window.newspackRAS.forEach((e=>e(S))),window.newspackRAS.push=e=>e(S);const b=S;var P=window;for(var O in t)P[O]=t[O];t.__esModule&&Object.defineProperty(P,"__esModule",{value:!0})})();